<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1 0 auto;
        }
        footer {
            flex-shrink: 0;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="notification-container"></div>
    
    <div class="main-content">
    <!-- Navigation -->
    <nav class="bg-slate-800 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-2xl font-bold">Order System</h1>
                <div class="flex space-x-4">
                    <button onclick="showTab('dashboard')" class="tab-btn px-4 py-2 rounded hover:bg-slate-700">Dashboard</button>
                    <button onclick="showTab('kunden')" class="tab-btn px-4 py-2 rounded hover:bg-slate-700">Kunden</button>
                    <button onclick="showTab('produkte')" class="tab-btn px-4 py-2 rounded hover:bg-slate-700">Produkte</button>
                    <button onclick="showTab('bestellungen')" class="tab-btn px-4 py-2 rounded hover:bg-slate-700">Bestellungen</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 class="text-3xl font-bold mb-6">Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="text-gray-500 text-sm">Kunden</div>
                    <div id="stats-kunden" class="text-3xl font-bold text-blue-600">-</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="text-gray-500 text-sm">Produkte</div>
                    <div id="stats-produkte" class="text-3xl font-bold text-green-600">-</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="text-gray-500 text-sm">Bestellungen</div>
                    <div id="stats-bestellungen" class="text-3xl font-bold text-purple-600">-</div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-xl font-bold mb-4">Letzte Bestellungen</h3>
                <div id="recent-orders"></div>
            </div>
        </div>

        <!-- Kunden Tab -->
        <div id="kunden" class="tab-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Kunden</h2>
                <button onclick="showKundeForm()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Neuer Kunde</button>
            </div>
            
            <div id="kunde-form" class="hidden bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-bold mb-4">Kunde bearbeiten</h3>
                <form onsubmit="saveKunde(event)">
                    <input type="hidden" id="kunde-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Name *</label>
                            <input type="text" id="kunde-name" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email *</label>
                            <input type="email" id="kunde-email" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Adresse</label>
                        <input type="text" id="kunde-adresse" class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Speichern</button>
                        <button type="button" onclick="hideKundeForm()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Abbrechen</button>
                    </div>
                </form>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Adresse</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aktionen</th>
                        </tr>
                    </thead>
                    <tbody id="kunden-list" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>

        <!-- Produkte Tab -->
        <div id="produkte" class="tab-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Produkte</h2>
                <button onclick="showProduktForm()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">+ Neues Produkt</button>
            </div>
            
            <div id="produkt-form" class="hidden bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-bold mb-4">Produkt bearbeiten</h3>
                <form onsubmit="saveProdukt(event)">
                    <input type="hidden" id="produkt-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Name *</label>
                            <input type="text" id="produkt-name" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Preis *</label>
                            <input type="number" step="0.01" id="produkt-preis" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Lagerbestand *</label>
                            <input type="number" id="produkt-lagerbestand" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Beschreibung</label>
                            <input type="text" id="produkt-beschreibung" class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Speichern</button>
                        <button type="button" onclick="hideProduktForm()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Abbrechen</button>
                    </div>
                </form>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Beschreibung</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Preis</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Lagerbestand</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aktionen</th>
                        </tr>
                    </thead>
                    <tbody id="produkte-list" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>

        <!-- Bestellungen Tab -->
        <div id="bestellungen" class="tab-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Bestellungen</h2>
                <button onclick="showBestellungForm()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">+ Neue Bestellung</button>
            </div>
            
            <div id="bestellung-form" class="hidden bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-bold mb-4">Neue Bestellung</h3>
                <form onsubmit="saveBestellung(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Kunde *</label>
                        <select id="bestellung-kunde" required class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-purple-500"></select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Produkte</label>
                        <div id="bestellung-positionen"></div>
                        <button type="button" onclick="addPosition()" class="mt-2 text-sm text-purple-600 hover:text-purple-700">+ Position hinzufügen</button>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Bestellung erstellen</button>
                        <button type="button" onclick="hideBestellungForm()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Abbrechen</button>
                    </div>
                </form>
            </div>

            <div class="space-y-4" id="bestellungen-list"></div>
        </div>
    </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-gray-300 mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-sm">&copy; 2025 Order System. Alle Rechte vorbehalten.</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-sm hover:text-white transition-colors">Impressum</a>
                    <a href="#" class="text-sm hover:text-white transition-colors">Kontakt</a>
                    <a href="#" class="text-sm hover:text-white transition-colors">Datenschutz</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = '/order-system/api';
        let kunden = [];
        let produkte = [];
        let bestellungen = [];

        // Tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'dashboard') loadDashboard();
            if (tabName === 'kunden') loadKunden();
            if (tabName === 'produkte') loadProdukte();
            if (tabName === 'bestellungen') loadBestellungen();
        }

        // Notifications
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            notification.className = `notification ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg`;
            notification.textContent = message;
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Dashboard
        async function loadDashboard() {
            try {
                const [kundenRes, produkteRes, bestellungenRes] = await Promise.all([
                    fetch(`${API_URL}/kunden`),
                    fetch(`${API_URL}/produkte`),
                    fetch(`${API_URL}/bestellungen`)
                ]);
                
                kunden = await kundenRes.json();
                produkte = await produkteRes.json();
                bestellungen = await bestellungenRes.json();

                document.getElementById('stats-kunden').textContent = kunden.length;
                document.getElementById('stats-produkte').textContent = produkte.length;
                document.getElementById('stats-bestellungen').textContent = bestellungen.length;

                const recentOrders = bestellungen.slice(-5).reverse();
                document.getElementById('recent-orders').innerHTML = recentOrders.length ? 
                    recentOrders.map(b => `
                        <div class="flex justify-between py-2 border-b">
                            <span>Bestellung #${b.id}</span>
                            <span class="font-bold">${b.gesamtpreis.toFixed(2)} €</span>
                            <span class="text-sm text-gray-500">${b.status}</span>
                        </div>
                    `).join('') : '<p class="text-gray-500">Keine Bestellungen vorhanden</p>';
            } catch (error) {
                showNotification('Fehler beim Laden des Dashboards', 'error');
            }
        }

        // Kunden
        async function loadKunden() {
            try {
                const res = await fetch(`${API_URL}/kunden`);
                kunden = await res.json();
                document.getElementById('kunden-list').innerHTML = kunden.map(k => `
                    <tr>
                        <td class="px-6 py-4">${k.id}</td>
                        <td class="px-6 py-4 font-medium">${k.name}</td>
                        <td class="px-6 py-4">${k.email}</td>
                        <td class="px-6 py-4">${k.adresse || '-'}</td>
                        <td class="px-6 py-4">
                            <button onclick="editKunde(${k.id})" class="text-blue-600 hover:text-blue-800 mr-3">Bearbeiten</button>
                            <button onclick="deleteKunde(${k.id})" class="text-red-600 hover:text-red-800">Löschen</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showNotification('Fehler beim Laden der Kunden', 'error');
            }
        }

        function showKundeForm() {
            document.getElementById('kunde-form').classList.remove('hidden');
            document.getElementById('kunde-id').value = '';
            document.getElementById('kunde-name').value = '';
            document.getElementById('kunde-email').value = '';
            document.getElementById('kunde-adresse').value = '';
        }

        function hideKundeForm() {
            document.getElementById('kunde-form').classList.add('hidden');
        }

        async function editKunde(id) {
            const kunde = kunden.find(k => k.id === id);
            if (!kunde) return;
            
            document.getElementById('kunde-form').classList.remove('hidden');
            document.getElementById('kunde-id').value = kunde.id;
            document.getElementById('kunde-name').value = kunde.name;
            document.getElementById('kunde-email').value = kunde.email;
            document.getElementById('kunde-adresse').value = kunde.adresse || '';
        }

        async function saveKunde(event) {
            event.preventDefault();
            const id = document.getElementById('kunde-id').value;
            const kunde = {
                name: document.getElementById('kunde-name').value,
                email: document.getElementById('kunde-email').value,
                adresse: document.getElementById('kunde-adresse').value
            };

            try {
                const url = id ? `${API_URL}/kunden/${id}` : `${API_URL}/kunden`;
                const method = id ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(kunde)
                });

                if (res.ok) {
                    showNotification('Kunde gespeichert');
                    hideKundeForm();
                    loadKunden();
                } else {
                    showNotification('Fehler beim Speichern', 'error');
                }
            } catch (error) {
                showNotification('Fehler beim Speichern', 'error');
            }
        }

        async function deleteKunde(id) {
            if (!confirm('Kunde wirklich löschen?')) return;
            
            try {
                const res = await fetch(`${API_URL}/kunden/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    showNotification('Kunde gelöscht');
                    loadKunden();
                } else {
                    showNotification('Fehler beim Löschen', 'error');
                }
            } catch (error) {
                showNotification('Fehler beim Löschen', 'error');
            }
        }

        // Produkte
        async function loadProdukte() {
            try {
                const res = await fetch(`${API_URL}/produkte`);
                produkte = await res.json();
                document.getElementById('produkte-list').innerHTML = produkte.map(p => `
                    <tr>
                        <td class="px-6 py-4">${p.id}</td>
                        <td class="px-6 py-4 font-medium">${p.name}</td>
                        <td class="px-6 py-4">${p.beschreibung || '-'}</td>
                        <td class="px-6 py-4">${p.preis.toFixed(2)} €</td>
                        <td class="px-6 py-4">${p.lagerbestand}</td>
                        <td class="px-6 py-4">
                            <button onclick="editProdukt(${p.id})" class="text-blue-600 hover:text-blue-800 mr-3">Bearbeiten</button>
                            <button onclick="deleteProdukt(${p.id})" class="text-red-600 hover:text-red-800">Löschen</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showNotification('Fehler beim Laden der Produkte', 'error');
            }
        }

        function showProduktForm() {
            document.getElementById('produkt-form').classList.remove('hidden');
            document.getElementById('produkt-id').value = '';
            document.getElementById('produkt-name').value = '';
            document.getElementById('produkt-preis').value = '';
            document.getElementById('produkt-lagerbestand').value = '';
            document.getElementById('produkt-beschreibung').value = '';
        }

        function hideProduktForm() {
            document.getElementById('produkt-form').classList.add('hidden');
        }

        async function editProdukt(id) {
            const produkt = produkte.find(p => p.id === id);
            if (!produkt) return;
            
            document.getElementById('produkt-form').classList.remove('hidden');
            document.getElementById('produkt-id').value = produkt.id;
            document.getElementById('produkt-name').value = produkt.name;
            document.getElementById('produkt-preis').value = produkt.preis;
            document.getElementById('produkt-lagerbestand').value = produkt.lagerbestand;
            document.getElementById('produkt-beschreibung').value = produkt.beschreibung || '';
        }

        async function saveProdukt(event) {
            event.preventDefault();
            const id = document.getElementById('produkt-id').value;
            const produkt = {
                name: document.getElementById('produkt-name').value,
                preis: parseFloat(document.getElementById('produkt-preis').value),
                lagerbestand: parseInt(document.getElementById('produkt-lagerbestand').value),
                beschreibung: document.getElementById('produkt-beschreibung').value
            };

            try {
                const url = id ? `${API_URL}/produkte/${id}` : `${API_URL}/produkte`;
                const method = id ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(produkt)
                });

                if (res.ok) {
                    showNotification('Produkt gespeichert');
                    hideProduktForm();
                    loadProdukte();
                } else {
                    showNotification('Fehler beim Speichern', 'error');
                }
            } catch (error) {
                showNotification('Fehler beim Speichern', 'error');
            }
        }

        async function deleteProdukt(id) {
            if (!confirm('Produkt wirklich löschen?')) return;
            
            try {
                const res = await fetch(`${API_URL}/produkte/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    showNotification('Produkt gelöscht');
                    loadProdukte();
                } else {
                    showNotification('Fehler beim Löschen', 'error');
                }
            } catch (error) {
                showNotification('Fehler beim Löschen', 'error');
            }
        }

        // Bestellungen
        async function loadBestellungen() {
            try {
                const res = await fetch(`${API_URL}/bestellungen`);
                bestellungen = await res.json();
                
                document.getElementById('bestellungen-list').innerHTML = bestellungen.map(b => `
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold">Bestellung #${b.id}</h3>
                                <p class="text-gray-500">Status: <span class="font-medium">${b.status}</span></p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-purple-600">${b.gesamtpreis.toFixed(2)} €</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            ${b.positionen.map(p => `
                                <div class="flex justify-between text-sm">
                                    <span>${p.produkt.name} × ${p.menge}</span>
                                    <span>${p.gesamtpreis.toFixed(2)} €</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showNotification('Fehler beim Laden der Bestellungen', 'error');
            }
        }

        async function showBestellungForm() {
            document.getElementById('bestellung-form').classList.remove('hidden');
            
            // Kunden laden
            if (kunden.length === 0) {
                const res = await fetch(`${API_URL}/kunden`);
                kunden = await res.json();
            }
            
            document.getElementById('bestellung-kunde').innerHTML = 
                '<option value="">Kunde wählen</option>' +
                kunden.map(k => `<option value="${k.id}">${k.name}</option>`).join('');
            
            // Produkte laden
            if (produkte.length === 0) {
                const res = await fetch(`${API_URL}/produkte`);
                produkte = await res.json();
            }
            
            document.getElementById('bestellung-positionen').innerHTML = '';
            addPosition();
        }

        function hideBestellungForm() {
            document.getElementById('bestellung-form').classList.add('hidden');
        }

        function addPosition() {
            const container = document.getElementById('bestellung-positionen');
            const div = document.createElement('div');
            div.className = 'flex gap-2 mb-2';
            div.innerHTML = `
                <select class="position-produkt flex-1 px-3 py-2 border rounded" required>
                    <option value="">Produkt wählen</option>
                    ${produkte.map(p => `<option value="${p.id}">${p.name} (${p.preis.toFixed(2)} €)</option>`).join('')}
                </select>
                <input type="number" class="position-menge w-24 px-3 py-2 border rounded" placeholder="Menge" min="1" required>
                <button type="button" onclick="this.parentElement.remove()" class="text-red-600 hover:text-red-800">✕</button>
            `;
            container.appendChild(div);
        }

        async function saveBestellung(event) {
            event.preventDefault();
            
            const kundeId = parseInt(document.getElementById('bestellung-kunde').value);
            const positionElements = document.querySelectorAll('#bestellung-positionen > div');
            
            const positionen = Array.from(positionElements).map(el => ({
                produktId: parseInt(el.querySelector('.position-produkt').value),
                menge: parseInt(el.querySelector('.position-menge').value)
            }));

            if (positionen.length === 0) {
                showNotification('Mindestens eine Position erforderlich', 'error');
                return;
            }

            try {
                const res = await fetch(`${API_URL}/bestellungen`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ kundeId, positionen })
                });

                if (res.ok) {
                    showNotification('Bestellung erstellt');
                    hideBestellungForm();
                    loadBestellungen();
                } else {
                    const error = await res.json();
                    showNotification(error.message || 'Fehler beim Erstellen', 'error');
                }
            } catch (error) {
                showNotification('Fehler beim Erstellen', 'error');
            }
        }

        // Init
        loadDashboard();
    </script>
</body>
</html>
