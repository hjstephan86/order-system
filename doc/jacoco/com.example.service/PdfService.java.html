<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PdfService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Order System</a> &gt; <a href="index.source.html" class="el_package">com.example.service</a> &gt; <span class="el_source">PdfService.java</span></div><h1>PdfService.java</h1><pre class="source lang-java linenums">package com.example.service;

import java.io.ByteArrayOutputStream;
import java.math.BigDecimal;
import java.time.format.DateTimeFormatter;

import com.example.entity.BestellPosition;
import com.example.entity.Rechnung;
import com.itextpdf.text.BaseColor;
import com.itextpdf.text.Chunk;
import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Element;
import com.itextpdf.text.Font;
import com.itextpdf.text.PageSize;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;

import jakarta.enterprise.context.ApplicationScoped;

@ApplicationScoped
<span class="nc" id="L26">public class PdfService {</span>

<span class="nc" id="L28">    private static final DateTimeFormatter DATE_FORMATTER = DateTimeFormatter.ofPattern(&quot;dd.MM.yyyy HH:mm&quot;);</span>

    public byte[] generiereRechnungsPdf(Rechnung rechnung) throws Exception {
<span class="nc" id="L31">        ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>
<span class="nc" id="L32">        Document document = new Document(PageSize.A4, 50, 50, 50, 50);</span>

        try {
<span class="nc" id="L35">            PdfWriter.getInstance(document, baos);</span>
<span class="nc" id="L36">            document.open();</span>

            // Header
<span class="nc" id="L39">            addHeader(document, rechnung);</span>
<span class="nc" id="L40">            document.add(Chunk.NEWLINE);</span>

            // Customer info
<span class="nc" id="L43">            addKundenInfo(document, rechnung);</span>
<span class="nc" id="L44">            document.add(Chunk.NEWLINE);</span>

            // Invoice details
<span class="nc" id="L47">            addRechnungsDetails(document, rechnung);</span>
<span class="nc" id="L48">            document.add(Chunk.NEWLINE);</span>

            // Items table
<span class="nc" id="L51">            addPositionenTabelle(document, rechnung);</span>
<span class="nc" id="L52">            document.add(Chunk.NEWLINE);</span>

            // Total
<span class="nc" id="L55">            addGesamtsumme(document, rechnung);</span>
<span class="nc" id="L56">            document.add(Chunk.NEWLINE);</span>

            // Footer
<span class="nc" id="L59">            addFooter(document);</span>

        } finally {
<span class="nc" id="L62">            document.close();</span>
        }

<span class="nc" id="L65">        return baos.toByteArray();</span>
    }

    private void addHeader(Document document, Rechnung rechnung) throws DocumentException {
<span class="nc" id="L69">        Font titleFont = new Font(Font.FontFamily.HELVETICA, 20, Font.BOLD);</span>
<span class="nc" id="L70">        Paragraph title = new Paragraph(&quot;RECHNUNG&quot;, titleFont);</span>
<span class="nc" id="L71">        title.setAlignment(Element.ALIGN_CENTER);</span>
<span class="nc" id="L72">        document.add(title);</span>

<span class="nc" id="L74">        Font normalFont = new Font(Font.FontFamily.HELVETICA, 10);</span>
<span class="nc" id="L75">        Paragraph company = new Paragraph(&quot;Ihr Firmenname\nMusterstraße 123\n12345 Musterstadt&quot;, normalFont);</span>
<span class="nc" id="L76">        company.setAlignment(Element.ALIGN_LEFT);</span>
<span class="nc" id="L77">        document.add(company);</span>
<span class="nc" id="L78">    }</span>

    private void addKundenInfo(Document document, Rechnung rechnung) throws DocumentException {
<span class="nc" id="L81">        Font boldFont = new Font(Font.FontFamily.HELVETICA, 10, Font.BOLD);</span>
<span class="nc" id="L82">        Font normalFont = new Font(Font.FontFamily.HELVETICA, 10);</span>

<span class="nc" id="L84">        Paragraph kundenInfo = new Paragraph();</span>
<span class="nc" id="L85">        kundenInfo.add(new Chunk(&quot;Kunde:\n&quot;, boldFont));</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (rechnung.getBestellung().getKunde().getGeschlecht() != null) {</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">            switch (rechnung.getBestellung().getKunde().getGeschlecht()) {</span>
                case MAENNLICH:
<span class="nc" id="L89">                    kundenInfo.add(new Chunk(&quot;Herrn\n&quot;, normalFont));</span>
<span class="nc" id="L90">                    break;</span>
                case WEIBLICH:
<span class="nc" id="L92">                    kundenInfo.add(new Chunk(&quot;Frau\n&quot;, normalFont));</span>
<span class="nc" id="L93">                    break;</span>
                case DIVERS:
<span class="nc" id="L95">                    kundenInfo.add(new Chunk(&quot;Divers\n&quot;, normalFont));</span>
                    break;
            }
        }
<span class="nc" id="L99">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getVorname() + &quot; &quot;, normalFont));</span>
<span class="nc" id="L100">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getName() + &quot;\n&quot;, normalFont));</span>
<span class="nc" id="L101">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getStrasse() + &quot; &quot;, normalFont));</span>
<span class="nc" id="L102">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getHausnummer() + &quot;\n&quot;, normalFont));</span>
<span class="nc" id="L103">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getPostleitzahl() + &quot; &quot;, normalFont));</span>
<span class="nc" id="L104">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getOrt() + &quot;\n&quot;, normalFont));</span>
<span class="nc" id="L105">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getLand() + &quot;\n&quot;, normalFont));</span>
<span class="nc" id="L106">        kundenInfo.add(new Chunk(rechnung.getBestellung().getKunde().getEmail(), normalFont));</span>

<span class="nc" id="L108">        document.add(kundenInfo);</span>
<span class="nc" id="L109">    }</span>

    private void addRechnungsDetails(Document document, Rechnung rechnung) throws DocumentException {
<span class="nc" id="L112">        Font boldFont = new Font(Font.FontFamily.HELVETICA, 10, Font.BOLD);</span>
<span class="nc" id="L113">        Font normalFont = new Font(Font.FontFamily.HELVETICA, 10);</span>

<span class="nc" id="L115">        PdfPTable table = new PdfPTable(2);</span>
<span class="nc" id="L116">        table.setWidthPercentage(50);</span>
<span class="nc" id="L117">        table.setHorizontalAlignment(Element.ALIGN_RIGHT);</span>

<span class="nc" id="L119">        table.addCell(createCell(&quot;Rechnungsnummer:&quot;, boldFont));</span>
<span class="nc" id="L120">        table.addCell(createCell(rechnung.getRechnungsnummer(), normalFont));</span>

<span class="nc" id="L122">        table.addCell(createCell(&quot;Rechnungsdatum:&quot;, boldFont));</span>
<span class="nc" id="L123">        table.addCell(createCell(rechnung.getErstellungsdatum().format(DATE_FORMATTER), normalFont));</span>

<span class="nc" id="L125">        table.addCell(createCell(&quot;Bestellnummer:&quot;, boldFont));</span>
<span class="nc" id="L126">        table.addCell(createCell(String.valueOf(rechnung.getBestellung().getId()), normalFont));</span>

<span class="nc" id="L128">        document.add(table);</span>
<span class="nc" id="L129">    }</span>

    private void addPositionenTabelle(Document document, Rechnung rechnung) throws DocumentException {
<span class="nc" id="L132">        Font boldFont = new Font(Font.FontFamily.HELVETICA, 10, Font.BOLD);</span>
<span class="nc" id="L133">        Font normalFont = new Font(Font.FontFamily.HELVETICA, 10);</span>

<span class="nc" id="L135">        PdfPTable table = new PdfPTable(4);</span>
<span class="nc" id="L136">        table.setWidthPercentage(100);</span>
<span class="nc" id="L137">        table.setWidths(new float[] { 3, 1, 2, 2 });</span>

        // Header
<span class="nc" id="L140">        table.addCell(createHeaderCell(&quot;Produkt&quot;, boldFont));</span>
<span class="nc" id="L141">        table.addCell(createHeaderCell(&quot;Menge&quot;, boldFont));</span>
<span class="nc" id="L142">        table.addCell(createHeaderCell(&quot;Einzelpreis&quot;, boldFont));</span>
<span class="nc" id="L143">        table.addCell(createHeaderCell(&quot;Gesamtpreis&quot;, boldFont));</span>

        // Items
<span class="nc bnc" id="L146" title="All 2 branches missed.">        for (BestellPosition position : rechnung.getBestellung().getPositionen()) {</span>
<span class="nc" id="L147">            table.addCell(createCell(position.getProdukt().getName(), normalFont));</span>
<span class="nc" id="L148">            table.addCell(createCell(String.valueOf(position.getMenge()), normalFont));</span>
<span class="nc" id="L149">            table.addCell(createCell(formatPrice(position.getProdukt().getPreis()), normalFont));</span>

<span class="nc" id="L151">            BigDecimal gesamtpreis = position.getProdukt().getPreis()</span>
<span class="nc" id="L152">                    .multiply(BigDecimal.valueOf(position.getMenge()));</span>
<span class="nc" id="L153">            table.addCell(createCell(formatPrice(gesamtpreis), normalFont));</span>
<span class="nc" id="L154">        }</span>

<span class="nc" id="L156">        document.add(table);</span>
<span class="nc" id="L157">    }</span>

    private void addGesamtsumme(Document document, Rechnung rechnung) throws DocumentException {
<span class="nc" id="L160">        Font boldFont = new Font(Font.FontFamily.HELVETICA, 12, Font.BOLD);</span>

<span class="nc" id="L162">        Paragraph total = new Paragraph();</span>
<span class="nc" id="L163">        total.setAlignment(Element.ALIGN_RIGHT);</span>
<span class="nc" id="L164">        total.add(new Chunk(&quot;Gesamtbetrag: &quot; + formatPrice(rechnung.getGesamtbetrag()), boldFont));</span>
<span class="nc" id="L165">        document.add(total);</span>
<span class="nc" id="L166">    }</span>

    private void addFooter(Document document) throws DocumentException {
<span class="nc" id="L169">        Font smallFont = new Font(Font.FontFamily.HELVETICA, 8);</span>
<span class="nc" id="L170">        Paragraph footer = new Paragraph(</span>
                &quot;Zahlbar innerhalb von 14 Tagen ohne Abzug.\n&quot; +
                        &quot;Bankverbindung: IBAN DE12 3456 7890 1234 5678 90 | BIC: ABCDEFGH&quot;,
                smallFont);
<span class="nc" id="L174">        footer.setAlignment(Element.ALIGN_CENTER);</span>
<span class="nc" id="L175">        document.add(footer);</span>
<span class="nc" id="L176">    }</span>

    private PdfPCell createCell(String text, Font font) {
<span class="nc" id="L179">        PdfPCell cell = new PdfPCell(new Phrase(text, font));</span>
<span class="nc" id="L180">        cell.setBorder(Rectangle.NO_BORDER);</span>
<span class="nc" id="L181">        cell.setPadding(5);</span>
<span class="nc" id="L182">        return cell;</span>
    }

    private PdfPCell createHeaderCell(String text, Font font) {
<span class="nc" id="L186">        PdfPCell cell = new PdfPCell(new Phrase(text, font));</span>
<span class="nc" id="L187">        cell.setBackgroundColor(BaseColor.LIGHT_GRAY);</span>
<span class="nc" id="L188">        cell.setPadding(5);</span>
<span class="nc" id="L189">        return cell;</span>
    }

    private String formatPrice(BigDecimal price) {
<span class="nc" id="L193">        return String.format(&quot;%.2f €&quot;, price);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>